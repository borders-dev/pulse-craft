{# @var plugin \bordersdev\craftpulse\Pulse #}
{# @var settings \bordersdev\craftpulse\models\Settings #}

{% import '_includes/forms.twig' as forms %}

{{ forms.autosuggestField({
    label: 'Secret Key',
    instructions: 'The secret key used to authenticate health check requests. Can be set via the `PULSE_SECRET_KEY` environment variable.',
    id: 'secretKey',
    name: 'secretKey',
    value: settings.secretKey,
    suggestEnvVars: true,
    required: true,
}) }}

{{ forms.textField({
    label: 'Endpoint Path',
    instructions: 'The URL path for the health check endpoint (e.g., `health` for `/health`).',
    id: 'endpointPath',
    name: 'endpointPath',
    value: settings.endpointPath,
    required: true,
}) }}

<hr>

<h2>Thresholds</h2>

{{ forms.textField({
    label: 'Disk Space Threshold',
    instructions: 'Alert when disk usage exceeds this percentage.',
    id: 'diskSpaceThreshold',
    name: 'diskSpaceThreshold',
    value: settings.diskSpaceThreshold,
    type: 'number',
    min: 1,
    max: 100,
    size: 5,
    unit: '%',
}) }}

{{ forms.textField({
    label: 'Queue Stuck Threshold',
    instructions: 'Consider a job stuck if it has been in the queue longer than this many seconds.',
    id: 'queueStuckThreshold',
    name: 'queueStuckThreshold',
    value: settings.queueStuckThreshold,
    type: 'number',
    min: 60,
    size: 10,
    unit: 'seconds',
}) }}

{{ forms.textField({
    label: 'Failed Login Window',
    instructions: 'Time window for counting failed login attempts.',
    id: 'failedLoginWindow',
    name: 'failedLoginWindow',
    value: settings.failedLoginWindow,
    type: 'number',
    min: 60,
    size: 10,
    unit: 'seconds',
}) }}

<hr>

<h2>Enabled Checks</h2>

<h3>Core</h3>

{{ forms.checkboxField({
    label: 'Database',
    instructions: 'Check database connectivity and response time.',
    id: 'enabledChecks-database',
    name: 'enabledChecks[database]',
    checked: settings.enabledChecks.database ?? true,
}) }}

{{ forms.checkboxField({
    label: 'Queue',
    instructions: 'Monitor queue jobs, stuck jobs, and failed jobs.',
    id: 'enabledChecks-queue',
    name: 'enabledChecks[queue]',
    checked: settings.enabledChecks.queue ?? true,
}) }}

<h3>System</h3>

{{ forms.checkboxField({
    label: 'Disk Space',
    instructions: 'Monitor disk usage on the storage volume.',
    id: 'enabledChecks-disk',
    name: 'enabledChecks[disk]',
    checked: settings.enabledChecks.disk ?? true,
}) }}

{{ forms.checkboxField({
    label: 'Memory',
    instructions: 'Monitor PHP memory usage.',
    id: 'enabledChecks-memory',
    name: 'enabledChecks[memory]',
    checked: settings.enabledChecks.memory ?? true,
}) }}

<h3>Updates</h3>

{{ forms.checkboxField({
    label: 'Craft Version',
    instructions: 'Check if Craft CMS is up to date.',
    id: 'enabledChecks-craftVersion',
    name: 'enabledChecks[craftVersion]',
    checked: settings.enabledChecks.craftVersion ?? true,
}) }}

{{ forms.checkboxField({
    label: 'Plugin Versions',
    instructions: 'Check if installed plugins are up to date.',
    id: 'enabledChecks-plugins',
    name: 'enabledChecks[plugins]',
    checked: settings.enabledChecks.plugins ?? true,
}) }}

<h3>Security</h3>

{{ forms.checkboxField({
    label: 'Debug Mode',
    instructions: 'Alert if dev mode is enabled.',
    id: 'enabledChecks-debugMode',
    name: 'enabledChecks[debugMode]',
    checked: settings.enabledChecks.debugMode ?? true,
}) }}

{{ forms.checkboxField({
    label: 'Failed Logins',
    instructions: 'Monitor failed login attempts.',
    id: 'enabledChecks-failedLogins',
    name: 'enabledChecks[failedLogins]',
    checked: settings.enabledChecks.failedLogins ?? true,
}) }}

<h3>Licensing</h3>

{{ forms.checkboxField({
    label: 'License Status',
    instructions: 'Check Craft and plugin license validity.',
    id: 'enabledChecks-license',
    name: 'enabledChecks[license]',
    checked: settings.enabledChecks.license ?? true,
}) }}

<h3>Configuration</h3>

{{ forms.checkboxField({
    label: 'Environment Variables',
    instructions: 'Check for missing environment variables referenced in config files.',
    id: 'enabledChecks-environment',
    name: 'enabledChecks[environment]',
    checked: settings.enabledChecks.environment ?? true,
}) }}

<h3>Integrations</h3>

{{ forms.checkboxField({
    label: 'Form Plugins',
    instructions: 'Monitor Formie and Freeform for failed email notifications.',
    id: 'enabledChecks-forms',
    name: 'enabledChecks[forms]',
    checked: settings.enabledChecks.forms ?? true,
}) }}
